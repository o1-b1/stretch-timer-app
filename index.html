<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d111a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Stretch Timer" />
  <title>Stretch Timer</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <style>
    :root {
      --bg: radial-gradient(circle at top, #1a2338 0%, #0d111a 52%, #07090f 100%);
      --card: rgba(255, 255, 255, 0.08);
      --card-border: rgba(255, 255, 255, 0.14);
      --text: #f4f7ff;
      --muted: #b9c0d4;
      --accent: #7aa2ff;
      --accent-2: #5de4c7;
      --danger: #ff6d85;
      --shadow: 0 18px 40px rgba(0, 0, 0, 0.36);
      --radius: 22px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      min-height: 100dvh;
      background: var(--bg);
      color: var(--text);
      font-family: "SF Pro Display", "SF Pro Text", "Inter", "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: calc(16px + env(safe-area-inset-top)) 14px calc(18px + env(safe-area-inset-bottom));
      letter-spacing: 0.01em;
    }

    .app {
      width: min(740px, 100%);
      display: grid;
      gap: 14px;
      align-content: start;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      padding: 18px;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.35rem, 4vw, 1.9rem);
      font-weight: 700;
    }

    .status {
      color: var(--muted);
      margin-top: 6px;
      font-size: 0.95rem;
    }

    .timer {
      font-size: clamp(2.1rem, 11vw, 3.9rem);
      font-weight: 700;
      margin: 10px 0 4px;
      font-variant-numeric: tabular-nums;
    }

    .step {
      font-size: clamp(1rem, 3.8vw, 1.32rem);
      color: #eef3ff;
      line-height: 1.25;
      min-height: 2.45em;
    }

    .totals {
      margin-top: 8px;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .progress {
      margin-top: 12px;
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.15);
      overflow: hidden;
    }

    .progress > span {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border-radius: inherit;
      transition: width 0.25s ease;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-top: 14px;
    }

    button {
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      border-radius: 14px;
      padding: 11px 10px;
      font-size: 0.97rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      cursor: pointer;
      transition: transform 0.12s ease, background-color 0.15s ease;
      -webkit-tap-highlight-color: transparent;
    }

    button:active {
      transform: scale(0.98);
    }

    button.primary {
      background: linear-gradient(120deg, #7aa2ff, #76d8ff);
      color: #061127;
      border-color: rgba(255, 255, 255, 0.45);
    }

    button.reset {
      color: #ffd1d9;
    }

    .settings {
      margin-top: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.93rem;
    }

    .settings input {
      width: 18px;
      height: 18px;
      accent-color: var(--accent-2);
    }

    .list-title {
      font-size: 0.93rem;
      color: var(--muted);
      margin-bottom: 10px;
    }

    ul {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 8px;
    }

    li button {
      width: 100%;
      text-align: left;
      border-radius: 14px;
      padding: 11px 12px;
      font-size: 0.95rem;
      font-weight: 500;
    }

    li.active button {
      border-color: rgba(125, 180, 255, 0.9);
      box-shadow: inset 0 0 0 1px rgba(120, 176, 255, 0.65);
      background: rgba(122, 162, 255, 0.2);
    }

    .small {
      display: inline-block;
      color: var(--muted);
      margin-left: 8px;
      font-size: 0.86rem;
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="card">
      <h1>Undo Sitting + Recover</h1>
      <div class="status" id="statusLine">Status: Ready</div>
      <div class="timer" id="timerDisplay">01:00</div>
      <div class="step" id="stepDisplay"></div>
      <div class="totals" id="totalsDisplay">Remaining total: --:--</div>

      <div class="progress" aria-label="Step progress">
        <span id="progressFill"></span>
      </div>

      <div class="controls">
        <button id="prevBtn" type="button">Prev</button>
        <button id="startPauseBtn" type="button" class="primary">Start</button>
        <button id="nextBtn" type="button">Next</button>
        <button id="resetBtn" type="button" class="reset">Reset</button>
      </div>

      <label class="settings" for="vibrateToggle">
        <input id="vibrateToggle" type="checkbox" checked />
        Vibrate on step change
      </label>
    </section>

    <section class="card">
      <div class="list-title">Stretch steps (tap to jump)</div>
      <ul id="stepList"></ul>
    </section>
  </main>

  <script>
    const steps = [
      { label: 'Half-Kneeling Hip Flexor — Left', seconds: 60 },
      { label: 'Half-Kneeling Hip Flexor — Right', seconds: 60 },
      { label: 'Pigeon Pose — Left', seconds: 60 },
      { label: 'Pigeon Pose — Right', seconds: 60 },
      { label: 'Couch Stretch — Left', seconds: 75 },
      { label: 'Couch Stretch — Right', seconds: 75 },
      { label: 'Hamstring Stretch — Left', seconds: 60 },
      { label: 'Hamstring Stretch — Right', seconds: 60 },
      { label: 'Open Book — Left', seconds: 45 },
      { label: 'Open Book — Right', seconds: 45 },
      { label: "Child's Pose + Lat — Center", seconds: 30 },
      { label: "Child's Pose + Lat — Left", seconds: 30 },
      { label: "Child's Pose + Lat — Right", seconds: 30 },
      { label: 'Doorway Chest Stretch — Both', seconds: 60 },
      { label: 'Deep Squat Hold — Hold', seconds: 60 }
    ];

    const statusLine = document.getElementById('statusLine');
    const timerDisplay = document.getElementById('timerDisplay');
    const stepDisplay = document.getElementById('stepDisplay');
    const totalsDisplay = document.getElementById('totalsDisplay');
    const progressFill = document.getElementById('progressFill');

    const prevBtn = document.getElementById('prevBtn');
    const startPauseBtn = document.getElementById('startPauseBtn');
    const nextBtn = document.getElementById('nextBtn');
    const resetBtn = document.getElementById('resetBtn');
    const vibrateToggle = document.getElementById('vibrateToggle');
    const stepList = document.getElementById('stepList');

    let index = 0;
    let remaining = steps[0].seconds;
    let isRunning = false;
    let ticker = null;

    function formatTime(seconds) {
      const safe = Math.max(0, Math.floor(seconds));
      const m = Math.floor(safe / 60).toString().padStart(2, '0');
      const s = (safe % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function remainingTotalSeconds() {
      return steps.reduce((sum, step, i) => {
        if (i < index) return sum;
        if (i === index) return sum + remaining;
        return sum + step.seconds;
      }, 0);
    }

    function buzz() {
      if (!vibrateToggle.checked || !('vibrate' in navigator)) return;
      navigator.vibrate([60, 40, 80]);
    }

    function buildStepList() {
      stepList.innerHTML = '';
      steps.forEach((step, i) => {
        const li = document.createElement('li');
        const button = document.createElement('button');
        button.type = 'button';
        button.textContent = `${i + 1}. ${step.label}`;
        const span = document.createElement('span');
        span.className = 'small';
        span.textContent = formatTime(step.seconds);
        button.appendChild(span);
        button.addEventListener('click', () => jumpTo(i));
        li.appendChild(button);
        stepList.appendChild(li);
      });
    }

    function updateButtons() {
      startPauseBtn.textContent = isRunning ? 'Pause' : (index === steps.length ? 'Restart' : 'Start');
      startPauseBtn.disabled = index === steps.length && isRunning;
    }

    function updateUi() {
      const done = index >= steps.length;
      if (done) {
        timerDisplay.textContent = '00:00';
        stepDisplay.textContent = 'Routine complete';
        totalsDisplay.textContent = 'Remaining total: 00:00';
        statusLine.textContent = 'Status: Done';
        progressFill.style.width = '100%';
      } else {
        const step = steps[index];
        timerDisplay.textContent = formatTime(remaining);
        stepDisplay.textContent = step.label;
        totalsDisplay.textContent = `Remaining total: ${formatTime(remainingTotalSeconds())}`;
        statusLine.textContent = `Status: ${isRunning ? 'Running' : 'Paused/Ready'}`;
        const progress = ((step.seconds - remaining) / step.seconds) * 100;
        progressFill.style.width = `${Math.min(100, Math.max(0, progress))}%`;
      }

      [...stepList.children].forEach((li, i) => {
        li.classList.toggle('active', i === index && index < steps.length);
      });

      updateButtons();
    }

    function stopTicker() {
      if (ticker) {
        clearInterval(ticker);
        ticker = null;
      }
    }

    function nextStep(fromTimer = false) {
      if (index < steps.length - 1) {
        index += 1;
        remaining = steps[index].seconds;
        buzz();
      } else {
        index = steps.length;
        remaining = 0;
        stopTicker();
        isRunning = false;
        if (fromTimer) buzz();
      }
      updateUi();
    }

    function prevStep() {
      if (index <= 0) {
        remaining = steps[0].seconds;
      } else if (index >= steps.length) {
        index = steps.length - 1;
        remaining = steps[index].seconds;
      } else {
        index -= 1;
        remaining = steps[index].seconds;
      }
      isRunning = false;
      stopTicker();
      updateUi();
    }

    function jumpTo(i) {
      if (i < 0 || i >= steps.length) return;
      index = i;
      remaining = steps[i].seconds;
      isRunning = false;
      stopTicker();
      updateUi();
    }

    function resetRoutine() {
      index = 0;
      remaining = steps[0].seconds;
      isRunning = false;
      stopTicker();
      updateUi();
    }

    function tick() {
      if (!isRunning || index >= steps.length) return;
      remaining -= 1;
      if (remaining <= 0) {
        nextStep(true);
      } else {
        updateUi();
      }
    }

    function startPause() {
      if (index >= steps.length) {
        resetRoutine();
      }

      isRunning = !isRunning;
      if (isRunning) {
        tick();
        ticker = setInterval(tick, 1000);
      } else {
        stopTicker();
      }
      updateUi();
    }

    prevBtn.addEventListener('click', prevStep);
    nextBtn.addEventListener('click', () => {
      isRunning = false;
      stopTicker();
      nextStep(false);
    });
    resetBtn.addEventListener('click', resetRoutine);
    startPauseBtn.addEventListener('click', startPause);

    document.addEventListener('visibilitychange', () => {
      if (document.hidden && isRunning) {
        stopTicker();
      } else if (!document.hidden && isRunning && !ticker) {
        ticker = setInterval(tick, 1000);
      }
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }

    buildStepList();
    updateUi();
  </script>
</body>
</html>
